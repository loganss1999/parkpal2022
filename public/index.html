<!DOCTYPE html>
<html lang="en">
<head>
	<title>ParkPal</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
	<link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <style>
        #map {position: absolute; top: 0; right: 0; bottom: 0; left: 0;}
      </style>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
	<header>
        <nav>
            <h1><img src="parkpal.png" alt="Parkpal logo" style="width:120px;height:110px;"></h1>
            <ul class="tabs">
                <li class="tab is-active">
                    <a data-switcher data-tab="1">Home</a>
                </li>
                <li class="tab">
                    <a data-switcher data-tab="2">About</a>
                </li>
                <li class="tab">
                    <a data-switcher data-tab="3">Contact</a>
                </li>
            </ul>
        </nav>
    </header>

	<main>
		<section class="pages">

            <div class="page is-active" data-page="1">
                <h2>Parking Simulator</h2>
                <form id="input-form" class="form-inline">
                    <button name = "car" type="submit" value="1" style="height: 30px; width: 80px;">Car 1</button>
                    <button name = "car" type="submit" value="2" style="height: 30px; width: 80px;">Car 2</button>
                    <button name = "car" type="submit" value="3" style="height: 30px; width: 80px;">Car 3</button>
                    <button name = "car" type="submit" value="4" style="height: 30px; width: 80px;">Car 4</button>
                    <button name = "car" type="submit" value="5" style="height: 30px; width: 80px;">Car 5</button>
                </form>
                <img src="gifs/parkpal.png" id="gif" height="360" width="640" alt="cars driving around" >
				<style type="text/css">
                    #map {margin-left: 850px; margin-top: 300px; height: 500px; width:500px; }
                </style>
                    <div id="map">
                    <a href="https://www.maptiler.com" style="position:absolute;left:0px;bottom:10px;z-index:999;"><img src="https://api.maptiler.com/resources/logo.svg" alt="MapTiler logo"></a>
                    </div>
            </div>

            <div class="page" data-page="2">
                <h2>A Little More About Us</h2>
                <p>
					Parking in urban areas is notoriously sparse and may require many irritating minutes searching for available spots to be able to find one large enough for your car. For NYC specifically, this is equivalent to 15 minutes per trip, and balloons to 107 hours per year. [Braibanti]  This project reduced the amount of time used to find these spots, and the irritation associated with it. This is accomplished creating a program that connects the cars already implemented and running sensors, including LiDAR detection to record available parking spots on a map, unconsciously as the user/driver goes about their daily tasks. This map is updated by and accessible to all other users of the application in the area. By doing this, it will ensure that the information provided by the system is as up to date and accurate as possible. This map, when accessed, allows users to find the location of an available street or lot parking spot, and drive directly to it, avoiding searching, and paying for costly garages. 
				</p>
            </div>


            <div class="page" data-page="3">
                <h2>Page 3</h2>
                <p>Welcome to the Contact page</p>
            </div>

        </section>
		<script type="application/javascript" src="app.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>

		<script>
		let markers = new Map();
	
	window.addEventListener('DOMContentLoaded', (_) => {
		var map = L.map('map').setView([42.3463, -71.0421], 15);
		  L.tileLayer('https://api.maptiler.com/maps/openstreetmap/{z}/{x}/{y}.jpg?key=DNCiULABgsnLAzJKiWCp',{
			tileSize: 512,
			zoomOffset: -1,
			minZoom: 5,
			attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
			crossOrigin: true
		  }).addTo(map);
		let websocket = new WebSocket("wss://" + window.location.host + "/websocket");
		let f = document.getElementById("parking-space");
		
		//sends button press to main.go via websocket
		let form = document.getElementById("input-form");
		form.addEventListener("submit", function (event) {
		event.preventDefault();
		var activeElement = document.activeElement;
		if(activeElement.value == "1") {
			document.getElementById("gif").src="gifs/1.gif";
		}
		if(activeElement.value == "2") {
			document.getElementById("gif").src="gifs/2.gif";
		}
		if(activeElement.value == "3") {
			document.getElementById("gif").src="gifs/3.gif";
		}
		if(activeElement.value == "4") {
			document.getElementById("gif").src="gifs/4.gif";
		}
		if(activeElement.value == "5") {
			document.getElementById("gif").src="gifs/5.gif";
		}
		websocket.send(
		  JSON.stringify({
			carid: activeElement.value
		  })
		);
		});
		//end of sending
			  
		  var greenIcon = L.icon({
		iconUrl: 'https://i.ibb.co/CQ1sxd0/Map-Marke2r-PN2-G-Clipart-removebg-preview.png',
		shadowUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC',
		// iconSize:     [23, 37],
		//custom marker is already correct size
		shadowSize:[80,100],
		iconAnchor:[32, 72],
		shadowAnchor:[29.5,95]
	
	});
		
	
		  function onClick(e) {
		alert(this.getLatLng());
	}
	
	function onMouseover(e) {
		this.openPopup();
	}
	
		var marker = L.marker([40.7440, -74.0324], {icon: greenIcon}).addTo(map).on('click', onClick);
		  markers.set(40.7440.toString() + -74.0324.toString(), marker); // tester code for Map of markers
		marker.bindPopup(4 + ' meters');
		  var marker = L.marker([40.731966, -74.039354], {icon: greenIcon}).addTo(map).on('click', onClick);
	
		  var marker = L.marker([40.740153, -74.033861], {icon: greenIcon}).addTo(map).on('click', onClick);
	
		  var marker = L.marker([40.739098, -74.032499], {icon: greenIcon}).addTo(map).on('click', onClick);
		
			//receive coordinates from websocket
		websocket.addEventListener("message", function (e) {
			let data = JSON.parse(e.data);
			let y = data.y;
			let x = data.x;
			let size = data.size;
			let lat = y*0.000008706 + 42.337098;
			let lon = x*0.0000123172 + -71.036649;
			var marker = L.marker([lat,lon], {icon: greenIcon}).addTo(map).on('click', onClick);
			marker.bindPopup(size + 'meters');
		});
		//end receive coordinates
	});
		</script>
	</body>

</html>
